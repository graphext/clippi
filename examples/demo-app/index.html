<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clippi Demo App</title>
  <script type="importmap">
    {
      "imports": {
        "@clippi/core": "/@clippi/core/index.js",
        "@clippi/cursor": "/@clippi/cursor/index.js",
        "@clippi/chat": "/@clippi/chat/index.js"
      }
    }
  </script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: white;
      border-bottom: 1px solid #e5e7eb;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-size: 24px;
      font-weight: 700;
      color: #6366f1;
    }

    .nav {
      display: flex;
      gap: 24px;
    }

    .nav a {
      color: #4b5563;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 8px;
      transition: background 0.15s;
    }

    .nav a:hover {
      background: #f3f4f6;
    }

    .nav a[data-testid="nav-data"] {
      color: #6366f1;
      background: #eef2ff;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: #6366f1;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
    }

    /* Main content */
    .main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 24px;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 600;
      color: #1f2937;
    }

    .actions {
      display: flex;
      gap: 12px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: opacity 0.15s;
      border: none;
      font-size: 14px;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn-primary {
      background: #6366f1;
      color: white;
    }

    .btn-secondary {
      background: white;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    /* Data table */
    .card {
      background: white;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
    }

    .table-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .table-title {
      font-weight: 600;
      color: #1f2937;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 12px 20px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }

    th {
      background: #f9fafb;
      font-weight: 500;
      color: #6b7280;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    td {
      color: #374151;
    }

    tr:hover {
      background: #f9fafb;
    }

    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 9999px;
      font-size: 13px;
      font-weight: 500;
    }

    .status-active {
      background: #d1fae5;
      color: #065f46;
    }

    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
    }

    .modal-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }

    .modal {
      background: white;
      border-radius: 12px;
      width: 480px;
      max-width: 90vw;
      transform: translateY(20px);
      transition: transform 0.2s;
    }

    .modal-overlay.open .modal {
      transform: translateY(0);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      color: #9ca3af;
      cursor: pointer;
    }

    .modal-body {
      padding: 24px;
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #374151;
      font-size: 14px;
    }

    .form-input, .form-select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      font-size: 14px;
    }

    .form-input:focus, .form-select:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid #e5e7eb;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Settings dropdown */
    .dropdown {
      position: relative;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: 8px;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      min-width: 200px;
      opacity: 0;
      pointer-events: none;
      transform: translateY(-10px);
      transition: opacity 0.15s, transform 0.15s;
    }

    .dropdown.open .dropdown-menu {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .dropdown-item {
      display: block;
      padding: 10px 16px;
      color: #374151;
      text-decoration: none;
      cursor: pointer;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-size: 14px;
    }

    .dropdown-item:hover {
      background: #f3f4f6;
    }

    .dropdown-divider {
      height: 1px;
      background: #e5e7eb;
      margin: 4px 0;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">DemoApp</div>
    <nav class="nav">
      <a href="#" data-testid="nav-dashboard">Dashboard</a>
      <a href="#" data-testid="nav-data" aria-label="Data section">Data</a>
      <a href="#" data-testid="nav-settings">Settings</a>
    </nav>
    <div class="user-menu">
      <div class="dropdown" id="user-dropdown">
        <button class="btn btn-secondary" data-testid="user-menu-btn" aria-label="User menu">
          <span class="user-avatar">JD</span>
        </button>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item" data-testid="profile-link">Profile</a>
          <a href="#" class="dropdown-item" data-testid="account-settings">Account Settings</a>
          <div class="dropdown-divider"></div>
          <button class="dropdown-item" data-testid="logout-btn">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="page-header">
      <h1 class="page-title">Data Management</h1>
      <div class="actions">
        <button class="btn btn-secondary" data-testid="import-btn" aria-label="Import data">
          Import
        </button>
        <button class="btn btn-primary" data-testid="export-btn" aria-label="Export data">
          Export
        </button>
        <button class="btn btn-primary" data-testid="create-dataset-btn" aria-label="Create new dataset">
          + New Dataset
        </button>
      </div>
    </div>

    <div class="card">
      <div class="table-header">
        <span class="table-title">Datasets</span>
        <input type="text" class="form-input" placeholder="Search..." style="width: 200px" data-testid="search-input" />
      </div>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Records</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Sales Q1 2024</td>
            <td>12,345</td>
            <td><span class="status status-active">Active</span></td>
            <td>Jan 15, 2024</td>
            <td>
              <button class="btn btn-secondary" style="padding: 6px 12px" data-testid="view-dataset">View</button>
            </td>
          </tr>
          <tr>
            <td>Customer Analytics</td>
            <td>8,901</td>
            <td><span class="status status-active">Active</span></td>
            <td>Feb 3, 2024</td>
            <td>
              <button class="btn btn-secondary" style="padding: 6px 12px">View</button>
            </td>
          </tr>
          <tr>
            <td>Marketing Campaign</td>
            <td>2,456</td>
            <td><span class="status status-pending">Processing</span></td>
            <td>Mar 10, 2024</td>
            <td>
              <button class="btn btn-secondary" style="padding: 6px 12px">View</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- Export Modal -->
  <div class="modal-overlay" id="export-modal">
    <div class="modal" role="dialog" aria-labelledby="export-modal-title">
      <div class="modal-header">
        <h2 class="modal-title" id="export-modal-title">Export Data</h2>
        <button class="modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Format</label>
          <select class="form-select" data-testid="export-format">
            <option value="csv" data-testid="format-csv">CSV</option>
            <option value="xlsx">Excel (XLSX)</option>
            <option value="json">JSON</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Date Range</label>
          <select class="form-select">
            <option>All time</option>
            <option>Last 30 days</option>
            <option>Last 90 days</option>
            <option>This year</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-testid="export-cancel">Cancel</button>
        <button class="btn btn-primary" data-testid="export-confirm">Export</button>
      </div>
    </div>
  </div>

  <!-- Create Dataset Modal -->
  <div class="modal-overlay" id="create-modal">
    <div class="modal" role="dialog" aria-labelledby="create-modal-title">
      <div class="modal-header">
        <h2 class="modal-title" id="create-modal-title">Create New Dataset</h2>
        <button class="modal-close" aria-label="Close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Dataset Name</label>
          <input type="text" class="form-input" placeholder="Enter name..." data-testid="dataset-name-input" />
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <input type="text" class="form-input" placeholder="Optional description..." />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" data-testid="create-cancel">Cancel</button>
        <button class="btn btn-primary" data-testid="create-confirm">Create</button>
      </div>
    </div>
  </div>

  <!-- Clippi Widget -->
  <script type="module">
    // In production, import from CDN or npm package
    // import '@clippi/chat'

    // For demo, we'll use the local dev server
    // The clippi-chat element will be available after the build

    // Demo: Handle modal interactions
    const exportBtn = document.querySelector('[data-testid="export-btn"]')
    const exportModal = document.getElementById('export-modal')
    const createBtn = document.querySelector('[data-testid="create-dataset-btn"]')
    const createModal = document.getElementById('create-modal')
    const userDropdown = document.getElementById('user-dropdown')

    // Export modal
    exportBtn?.addEventListener('click', () => {
      exportModal.classList.add('open')
    })

    exportModal?.addEventListener('click', (e) => {
      if (e.target === exportModal || e.target.closest('.modal-close') || e.target.closest('[data-testid="export-cancel"]')) {
        exportModal.classList.remove('open')
      }
    })

    // Create modal
    createBtn?.addEventListener('click', () => {
      createModal.classList.add('open')
    })

    createModal?.addEventListener('click', (e) => {
      if (e.target === createModal || e.target.closest('.modal-close') || e.target.closest('[data-testid="create-cancel"]')) {
        createModal.classList.remove('open')
      }
    })

    // User dropdown
    userDropdown?.querySelector('button')?.addEventListener('click', () => {
      userDropdown.classList.toggle('open')
    })

    document.addEventListener('click', (e) => {
      if (!userDropdown?.contains(e.target)) {
        userDropdown?.classList.remove('open')
      }
    })
  </script>

  <!-- Clippi Chat Widget -->
  <script type="module">
    import '@clippi/chat'
  </script>
  <clippi-chat
    manifest="/guide.manifest.json"
    endpoint="/api/clippi/chat"
    theme="auto"
  />
</body>
</html>
